<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pathfinding Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map {
      height: 600px;
    }
    #controls {
      margin: 10px 0;
    }
  </style>
</head>
<body>

  <div id="controls">
    From:
    <select id="from"></select>
    To:
    <select id="to"></select>
    <button onclick="findPath()">Tìm đường</button>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
  const map = L.map('map').setView([21.0045, 105.8456], 16);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  const points = {
    "Nha xe D9": [21.004061,105.844573],
    "Nha xe D3-5": [21.004972,105.845431],
    "Nha xe C7": [21.005054, 105.844911],
    "Nha xe C5": [21.005863, 105.844629],
    "Nha xe D4-6": [21.004592,105.842322],
    "Nha xe B1": [21.005002,105.846058],
    "Nha xe TC": [21.002553,105.847055],
    "Nha xe B13": [21.006460,105.847312],
    "Nha xe B6": [21.006319,105.846545],
  };

  const fromSelect = document.getElementById('from');
  const toSelect = document.getElementById('to');

  let routeLine; // lưu đối tượng polyline để xoá nếu cần

  for (let id in points) {
    fromSelect.add(new Option(id, id));
    toSelect.add(new Option(id, id));
    L.marker(points[id]).addTo(map).bindPopup(id);
  }

  async function findPath() {
    const from = fromSelect.value;
    const to = toSelect.value;
    if (!from || !to || from === to) return;

    const response = await fetch(`http://localhost:8080/path?from=${from}&to=${to}`);
    const path = await response.json();

    if (routeLine) map.removeLayer(routeLine); // xoá đường cũ nếu có

    routeLine = L.polyline(path.map(p => [p.lat, p.lng]), {
      color: 'blue',
      weight: 5
    }).addTo(map);

    map.fitBounds(routeLine.getBounds());
  }
</script>

</body>
</html>
